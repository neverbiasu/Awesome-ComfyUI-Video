# 🎬 混元视频包装器 (HunyuanVideoWrapper) 节点

## 🔍 概述

| 项目         | 详情                                                               |
| ------------ | ------------------------------------------------------------------ |
| 📌 **作者**  | [@Kijai](https://github.com/Kijai  )                                 |
| 📅 **版本**  | 1.0.0+                                                           |
| 🏷️ **类别** | 视频加载与处理, 图像特效, 模型工具集       |
| 🔗 **仓库** | [GitHub 仓库链接](https://github.com/Kijai/HunyuanVideoWrapper  ) |

## 📝 简介
`HunyuanVideoWrapper` 提供了一套全面的节点，用于视频生成、处理和增强。它包括采样、编码、解码工具，以及上下文管理、CFG、LoRA 集成和逆向采样等高级功能。

## 📊 节点列表

| 节点名称                             | 主要功能                                                          | 类别                 | 频率 | 常见使用场景                            | 推荐度 | 在工作流中的角色                                        |
| ------------------------------------- | ---------------------------------------------------------------------- | ------------------------ | --------- | ------------------------------------------ | ------ | ------------------------------------------------------- |
| **DownloadAndLoadHyVideoTextEncoder** | 下载并加载 LLM 或 CLIP 文本编码器用于条件化             | 输入/输出加载器        | 7         | 提示词管线的文本嵌入输入  | ★★★★☆          | 为`TextEncode`节点提供 `HYVIDTEXTENCODER`       |
| **HyVideoTextEncode**                 | 将文本提示词编码为条件化嵌入                       | 条件化编码器     | 7         | 文本到视频的提示词嵌入             | ★★★★☆          | 将语言提示词转换为模型可用的向量 |
| **HyVideoModelLoader**                | 加载核心模型：UNet、调度器、LoRA、注意力机制、精度           | 输入/输出加载器        | 7         | 初始化生成管线             | ★★★★★          | 为采样器节点提供 `HYVIDEOMODEL`                |
| **HyVideoVAELoader**                  | 加载 3D VAE 用于潜变量-图像帧转换                         | 输入/输出加载器        | 7         | 编码/解码潜变量帧                | ★★★★★          | 为编码器/解码器节点提供 `VAE`                 |
| **HyVideoSampler**                    | 核心的时空潜变量视频去噪采样器                    | 生成采样器       | 7         | 文本到视频 / 图像到视频             | ★★★★★          | 生成最终的 `LATENT` 视频张量                    |
| **HyVideoDecode**                     | 将潜变量视频解码为图像帧                                  | 解码器                  | 7         | 渲染输出帧                       | ★★★★★          | 生成视频的视觉输出                       |
| **HyVideoBlockSwap**                  | 交换 UNet 模块或将其卸载到 CPU 以进行优化                    | 架构控制    | 5         | 混合 CPU/GPU 或结构实验    | ★★★★☆          | 为模型加载器提供 `BLOCKSWAPARGS`                |
| **HyVideoTorchCompileSettings**       | 生成 `torch.compile` 设置以提高速度并减少 VRAM 占用       | 性能优化器    | 4         | CUDA 图编译                     | ★★★★☆          | 与 `ModelLoader` 链接以启用编译          |
| **HyVideoTeaCache**                   | 缓存 Transformer 激活以在采样期间节省内存           | 缓存优化器        | 4         | 长视频推理                       | ★★★★☆          | 为采样器提供 `TEACACHEARGS`                      |
| **HyVideoEncode**                     | 将单帧编码到潜空间                                  | 编码器                  | 3         | I2V 工作流                              | ★★★☆☆          | 将输入图像转换为潜变量格式                   |
| **HyVideoEnhanceAVideo**             | 生成去噪/放大参数以改善输出                  | 后期处理          | 3         | 长序列增强                  | ★★★☆☆          | 对最终视频应用细节增强               |
| **HyVideoLoraSelect**                 | 加载并混合 LoRA 权重（带强度/掩码）                        | LoRA 管理器             | 3         | 风格或角色控制                 | ★★★☆☆          | 为模型加载器提供 `HYVIDLORA`                    |
| **HyVideoI2VEncode**                  | 将文本 + 可选图像编码为视频嵌入                      | 条件化编码器     | 2         | 图像到视频工作流                   | ★★★☆☆          | 生成多模态视频嵌入                    |
| **HyVideoEncodeKeyframes**           | 将开始/结束关键帧编码到潜空间                           | 编码器                  | 2         | 关键帧引导的插值              | ★★★☆☆          | 实现姿势或故事板插值                |
| **HyVideoGetClosestBucketSize**       | 计算最接近的模型支持的分辨率桶                    | 分辨率工具          | 2         | 将输入调整为有效尺寸           | ★★★☆☆          | 输出有效的宽度/高度                              |
| **HyVideoCFG**                        | 构建无分类器指导 (CFG) 调度和权重              | CFG 管理器              | 1         | 动态调整提示词影响        | ★★★☆☆          | 随时间控制无条件分支的权重          |
| **HyVideoTextImageEncode**           | 将两个图像和文本编码为融合的条件化嵌入         | 条件化编码器     | 1         | IP2V (图像 + 提示词到视频)             | ★★★★☆          | 构建多模态提示词嵌入                     |
| **HyVideoInverseSampler**            | 将潜变量反向采样回噪声                                    | 反向采样器          | 1         | 潜变量编辑或反演                | ★★★★☆          | 为可编辑的再生成提供噪声               |
| **HyVideoReSampler**                 | 使用更新的种子、CFG 或运动重新采样潜变量                      | 重采样器                | 1         | 运动的后期优化                  | ★★★☆☆          | 无需完全重新初始化即可应用新设置      |
| **HyVideoPromptMixSampler**         | 使用插值曲线随时间混合多个嵌入           | 混合采样器            | 1         | 提示词/风格混合与过渡       | ★★★★☆          | 提示词之间的平滑过渡                      |
| **HyVideoLoraBlockEdit**             | 启用/禁用特定的 LoRA 模块                                    | LoRA 调整器             | 1         | 细粒度 LoRA 混合                 | ★★★☆☆          | 按模块优化 LoRA 注入                        |
| **SplineEditor**                      | 用于权重插值曲线的可视化编辑器                       | 插值曲线工具 | 1         | 提示词过渡                         | ★★★☆☆          | 与 `PromptMixSampler` 配合使用以控制过渡     |
| **HyVideoEnableAVideo**             | 配置加权的 Enhance-A-Video 参数                          | 后期处理          | 1         | 与 `EnhanceAVideo` 配合使用                  | ★★★☆☆          | —                                                       |
| **HyVideoLatentPreview**             | 预览中间潜变量视频以供调试                        | 可视化            | 1         | 调试潜变量阶段                    | ★☆☆☆☆          | 需要启用 VHS 潜变量预览                     |
| **SetNode / GetNode / INTConstant**  | 设置/获取全局变量 (例如帧数、索引范围)              | 工具                  | 多个      | 跨节点参数共享               | ★☆☆☆☆          | 管理跨分离节点的参数             |
| **HyVideoCustomPromptTemplate**      | 用于提示词格式化的自定义模板                                  | 工具                  | 1         | 结构化提示词控制                  | ★☆☆☆☆          | 用作 `TextEncode` 的输入                           |
| **HyVideoSTG**                        | 生成时空指导参数                            | 运动控制           | 1         | 运动一致性，蒙版流           | ★★★★☆          | 为采样器提供 `STGARGS`                           |
| **HunyuanVideoFresca**              | 实验性的基于频率的运动调制 (FreSca)                | 实验性             | 1         | 频谱风格混合                    | ★★★☆☆          | 为去噪或输出阶段提供 `FRESCAARGS`    |
| **HunyuanVideoSLG**                  | 在 UNet 模块上选择性跳过无条件指导                 | 实验性             | 1         | UNet 消融和测试                  | ★★☆☆☆          | 为采样器或模型加载器提供 `SLGARGS`           |
| **HyVideoLoopArgs**                  | 为循环潜变量转换创建循环参数                | 循环工具             | 1         | 无缝循环或变形效果       | ★★☆☆☆          | 为采样器提供 `LOOPARGS`                          |
| **HyVideoContextOptions**            | 管理长序列生成的上下文窗口大小/步幅         | 上下文管理       | 1         | 带帧重叠的长视频              | ★★★☆☆          | 为采样器提供 `CTXARGS`                           |

## 📑 核心节点详情

### DownloadAndLoadHyVideoTextEncoder

| **参数名称**                | **类型**                        | **默认值**                                     | **属性** | **描述**                                                                        |
|-----------------------------|---------------------------------|------------------------------------------|----------|---------------------------------------------------------------------------------|
| `llm_model`               | 下拉选项<sup>1</sup>            | "Kijai/llava-llama-3-8b-text-encoder-tokenizer" | 必需     | 用于文本编码的大型语言模型 (LLM)                                     |
| `clip_model`              | 下拉选项<sup>2</sup>            | "disabled"                               | 可选     | CLIP视觉模型 (可选，用于多模态编码)                                       |
| `precision`               | 下拉选项<sup>3</sup>            | "bf16"                                   | 可选     | 浮点精度模式                                                              |
| `apply_final_norm`        | 布尔值                          | False                                    | 可选     | 对文本嵌入向量应用最终归一化层                                               |
| `hidden_state_skip_layer` | 整数                            | 2                                        | 可选     | 从指定层跳过隐藏状态 (减少计算量)                                       |
| `quantization`            | 下拉选项<sup>4</sup>            | "disabled"                               | 可选     | 用于内存优化的量化方法                                                       |
| `load_device`             | 下拉选项                        | "offload_device"                         | 可选     | 加载文本编码器的设备 (GPU 或 CPU)                                        |

**输出：** `HYVIDTEXTENCODER`

**使用场景：**
- **文本到视频**工作流，需要高级语言理解
- 当 `clip_model` 启用时进行多模态编码 (文本 + 图像)
- 通过 `quantization` 和 `offload_device` 在低资源环境中使用

---

### HyVideoTextEncode (HyVideo文本编码)

| **参数名称**                | **类型**                        | **默认值**                                     | **属性** | **描述**                                                                        |
| ----------------------- | --------------------- | ----------- | ---------- | ----------------------------------------------------------------------- |
| `text`                  | `字符串`              | —           | 必需       | 要嵌入的文本提示                                                           |
| `text_encoder`          | `HYVIDTEXTENCODER`    | —           | 必需       | 从 `DownloadAndLoadHyVideoTextEncoder` 加载的文本编码器对象             |
| `is_negative_prompt`    | `布尔值`              | `False`     | 可选       | 将提示标记为负向条件 (用于分类器自由引导)                                   |
| `custom_prompt_context` | `CustomPromptContext` | —           | 可选       | 对LLM使用的结构化提示模板支持                                                |

**输出**:`HYVIDEMBEDS` – 用作条件输入的编码嵌入向量

**使用场景**：
- **文本到视频**工作流的标准提示编码
- 用于正向和负向条件分支
- 通过提示格式化支持**自定义提示模板**

---

### HyVideoModelLoader (HyVideo模型加载器)

| **参数名称**                | **类型**                        | **默认值**                                     | **属性** | **描述**                                                                        |
|----------------------|-------------------|--------------------|-----------|-----------------------------------------------------------------------------|
| `model`              | `文件夹路径列表`      | —                  | 必需      | `ComfyUI/models/diffusion_models` 目录下的路径                              |
| `base_precision`     | 下拉选项            | `bf16`             | 必需      | 用于基础权重的精度类型                                                       |
| `quantization`       | 下拉选项            | `disabled`         | 必需      | 对权重应用8位量化或保持完整精度                                                |
| `load_device`        | 下拉选项            | `main_device`      | 必需      | 加载目标设备：GPU或CPU                                                      |
| `attention_mode`     | 下拉选项            | `flash_attn_varlen`| 可选      | 使用的注意力实现类型                                                         |
| `compile_args`       | `COMPILEARGS`     | —                  | 可选      | 可选的Torch编译加速设置                                                    |
| `block_swap_args`    | `BLOCKSWAPARGS`   | —                  | 可选      | 用于卸载或替换模块 (参见 `HyVideoBlockSwap`)                               |
| `lora`               | `HYVIDLORA`       | `None`             | 可选      | LoRA权重文件，包含强度和模块掩码                                               |
| `auto_cpu_offload`   | 布尔值              | `False`            | 可选      | 自动将未使用的模块卸载到CPU                                                  |
| `upcast_rope`        | 布尔值              | `True`             | 可选      | 对旋转位置嵌入使用float32以提高数值稳定性                                    |

**输出**：**`HYVIDEOMODEL`** - `HyVideoSampler` 和其他生成节点所需的完全初始化的模型对象。

**使用场景**：
- 总是任何HunyuanVideo生成管线中的第一个节点
- 动态切换不同的UNet检查点
- 集成LoRA、量化和模块卸载
- 切换注意力后端以权衡速度/质量
- 激活 `torch.compile` 和内存优化功能

---

### HyVideoVAELoader (HyVideo VAE加载器)

| **参数名称**                | **类型**                        | **默认值**                                     | **属性** | **描述**                                                                        |
| -------------- | ------------------------- | ----------- | ---------- | ----------------------------------------------- |
| `model_name`   | `文件夹路径列表 (vae)`  | —           | 必需       | 从 `ComfyUI/models/vae` 目录下的模型中选择      |
| `precision`    | `fp16`, `fp32`, `bf16`    | `bf16`      | 可选       | 推理用浮点精度                                    |
| `compile_args` | `COMPILEARGS`             | —           | 可选       | 使用 `torch.compile` 的可选编译设置             |

**输出：** `VAE`

**使用场景：**
* 用于将输入图像**编码**到潜变量空间
* 用于将潜变量输出**解码**回视频帧
* 与编码器/采样器/解码器节点配对使用

---

## HyVideoSampler (HyVideo采样器)

| **参数名称**                | **类型**                        | **默认值**                                     | **属性** | **描述**                                                                        |
| ------------------------- | ---------------------------- | ---------------------------- | ---------- | ----------------------------------------------------------------- |
| `model`                   | `HYVIDEOMODEL`               | —                            | 必需       | 通过 `HyVideoModelLoader` 加载的核心模型。                       |
| `hyvid_embeds`            | `HYVIDEMBEDS`                | —                            | 必需       | 从提示编码器生成的条件嵌入向量。                                     |
| `width`                   | `整数`                       | `512`                        | 必需       | 输出视频帧宽度 (必须是16的倍数)。                                   |
| `height`                  | `整数`                       | `512`                        | 必需       | 输出视频帧高度 (必须是16的倍数)。                                   |
| `num_frames`              | `整数`                       | `49`                         | 必需       | 视频帧数。必须满足 `(num_frames - 1) % 4 == 0`。                     |
| `steps`                   | `整数`                       | `30`                         | 必需       | 采样循环中使用的去噪步数。                                           |
| `embedded_guidance_scale` | `浮点数`                     | `6.0`                        | 必需       | 提示嵌入向量的CFG强度。                                            |
| `flow_shift`              | `浮点数`                     | `9.0`                        | 必需       | 控制时间流强度 (运动引导)。                                         |
| `seed`                    | `整数`                       | `0`                          | 必需       | 用于可复现性的随机种子。                                               |
| `force_offload`           | `布尔值`                     | `True`                       | 必需       | 采样后是否卸载模型以释放GPU显存。                                    |
| `samples`                 | `LATENT`                     | `None`                       | 可选       | 用于视频到视频或重新生成的输入潜变量。                                   |
| `image_cond_latents`      | `LATENT`                     | `None`                       | 可选       | 从图像编码派生的初始潜变量 (用于I2V)。                                |
| `denoise_strength`        | `浮点数`                     | `1.0`                        | 可选       | 用于控制I2V工作流期间插值强度。                                      |
| `stg_args`                | `STGARGS`                    | —                            | 可选       | 来自 `HyVideoSTG` 的时空引导参数。                                 |
| `context_options`         | `HYVIDCONTEXT`               | —                            | 可选       | Transformer上下文窗口配置。                                        |
| `feta_args`               | `FETAARGS`                   | —                            | 可选       | 来自 `HyVideoEnhanceAVideo` 的特征增强设置。                       |
| `teacache_args`           | `TEACACHEARGS`               | —                            | 可选       | Transformer激活缓存配置。                                          |
| `scheduler`               | `枚举`                       | `FlowMatchDiscreteScheduler` | 可选       | 去噪期间使用的采样算法调度器。                                         |
| `riflex_freq_index`       | `整数`                       | `0`                          | 可选       | 控制RIFLEX插值频率 (0表示禁用RIFLEX)。                             |
| `i2v_mode`                | `"stability"` 或 `"dynamic"` | `dynamic`                    | 可选       | I2V模式：`dynamic`适应运动，`stability`减少方差。                   |
| `loop_args`               | `LOOPARGS`                   | —                            | 可选       | 循环一致性配置 (用于循环生成)。                                     |
| `fresca_args`             | `FRESCA_ARGS`                | —                            | 可选       | 基于频率的运动控制参数 (FreSca)。                                  |
| `slg_args`                | `SLGARGS`                    | —                            | 可选       | 来自 `HunyuanVideoSLG` 的选择性潜变量引导参数。                        |
| `mask`                    | `MASK`                       | —                            | 可选       | 用于部分或修复式生成的像素/帧掩码。                                    |

**输出**：**`samples`** (`LATENT`) – 最终的潜变量视频张量，将使用 `HyVideoDecode` 解码。

**使用场景**：
* 所有**文本到视频**、**图像到视频**和**视频到视频**工作流的核心引擎
* 接受外部潜变量用于**风格迁移**、**混音**或**条件延续**
* 与可选模块配合使用：`STG`、`TeaCache`、`FETA`、`FreSca`、`LoopArgs`、`SLG`、`RIFLEX`
* 适用于具有自适应内存节省选项的长、高分辨率序列

---

### HyVideoDecode (HyVideo解码)

| **参数名称**                | **类型**                        | **默认值**                                     | **属性** | **描述**                                                                        |
| ------------------------------ | --------- | ----------- | ---------- | ---------------------------------------------------------- |
| `vae`                          | `VAE`     | —           | 必需       | 从 `HyVideoVAELoader` 加载的VAE模型。                         |
| `samples`                      | `LATENT`  | —           | 必需       | 要解码的潜变量视频张量。                                       |
| `enable_vae_tiling`            | `布尔值`    | `True`      | 必需       | 启用分块以减少显存占用。                                         |
| `temporal_tiling_sample_size`  | `整数`    | `64`        | 必需       | 潜变量帧分块大小 (越小显存占用越少，接缝越多)。                           |
| `spatial_tile_sample_min_size` | `整数`    | `256`       | 必需       | 最小空间分块大小 (像素)。                                       |
| `auto_tile_size`               | `布尔值`    | `True`      | 必需       | 忽略以上设置并使用默认分块大小。                                   |
| `skip_latents`                 | `整数`    | `0`         | 可选       | 从潜变量输入开头跳过的帧数。                                     |
| `balance_brightness`           | `布尔值`    | `False`     | 可选       | 尝试校正分块间的亮度。                                         |

**输出**：`IMAGE`

**使用场景**：
* 将最终潜变量张量转换为**可见帧**所必需
* 在大多数工作流中于 `HyVideoSampler` 之后使用
* 通过**分块**技术适用于低内存环境下的长视频处理

---

### HyVideoBlockSwap (HyVideo模块交换)

| **参数名称**                | **类型**                        | **默认值**                                     | **属性**   | **描述**                                       |
| ------------------------ | -------- | ----------- | -------- | ---------------------------------------------- |
| `double_blocks_to_swap`  | 整数     | 20          | 必需     | 要卸载到CPU的双模块数量。                           |
| `single_blocks_to_swap`  | 整数     | 0           | 必需     | 要卸载到CPU的单模块数量。                           |
| `offload_txt_in`         | 布尔值   | False       | 必需     | 是否卸载 `txt_in` 层。                             |
| `offload_img_in`         | 布尔值   | False       | 必需     | 是否卸载 `img_in` 层。                             |

**输出**：`BLOCKSWAPARGS`

**使用场景**：
* 与 `HyVideoModelLoader` 配合使用，通过部分CPU卸载来减少显存占用。
* 常见于低内存环境或大批量处理。

---

### HyVideoTorchCompileSettings (HyVideo Torch编译设置)

| **参数名称**                | **类型**                        | **默认值**                                     | **属性**   | **描述**                                                                          |
|--------------------------------|---------------------|-------------|----------|---------------------------------------------------------------------------------|
| `backend`                    | 下拉选项              | "inductor"  | 必需     | Torch编译后端 (`inductor` 或 `cudagraphs`)                               |
| `fullgraph`                  | 布尔值              | False       | 必需     | 强制全图编译 (更好的优化但兼容性较低)                                          |
| `mode`                       | 下拉选项<sup>1</sup>  | "default"   | 必需     | 编译优化模式                                                               |
| `dynamic`                    | 布尔值              | False       | 必需     | 启用动态形状支持 (针对长序列优化)                                              |
| `dynamo_cache_size_limit`    | 整数                | 64          | 必需     | 动态编译缓存大小 (MB)                                                       |
| `compile_single_blocks`      | 布尔值              | True        | 必需     | 编译单模块                                                                |
| `compile_double_blocks`      | 布尔值              | True        | 必需     | 编译双模块                                                                |
| `compile_txt_in`             | 布尔值              | False       | 必需     | 编译文本输入层                                                              |
| `compile_vector_in`          | 布尔值              | False       | 必需     | 编译向量输入层                                                              |
| `compile_final_layer`        | 布尔值              | False       | 必需     | 编译最终输出层                                                              |

**输出**：`COMPILEARGS`

**使用场景**：
- 最大化推理速度 (例如实时生成)
- 针对长视频生成 (>100帧) 的显存优化

---

### HyVideoTeaCache (HyVideo TeaCache)

| **参数名称**                | **类型**                              | **默认值**          | **属性**   | **描述**                                                                        |
| --------------- | ----------------------------------- | ----------------- | -------- | --------------------------------------------------------------------- |
| `rel_l1_thresh` | 浮点数                                | 0.15              | 必需     | 缓存的积极程度；越高速度越快但伪影风险越大                                    |
| `cache_device`  | `["main_device", "offload_device"]` | "offload_device"  | 必需     | 缓存Transformer激活值的设备                                            |
| `start_step`    | 整数                                  | 0                 | 必需     | 应用TeaCache的起始采样步骤                                               |
| `end_step`      | 整数                                  | -1                | 必需     | 应用TeaCache的结束步骤 (`-1` = 直到结束)                                |

**输出：** `TEACACHEARGS`

**使用场景：**
* 通过**缓存Transformer激活值**来加速采样
* 适用于重新计算开销大的**长视频生成**
* 与卸载设备配合使用时可以**减少显存占用**

---

### HyVideoEncode (HyVideo编码)

| **参数名称**                | **类型**                        | **默认值**                                     | **属性** | **描述**                                                                        |
|--------------------------------|---------------------|-------------|----------|---------------------------------------------------------------------------------|
| `vae`                        | VAE               | —           | 必需     | 通过 `HyVideoVAELoader` 加载的VAE模型                                        |
| `image`                      | IMAGE             | —           | 必需     | 输入图像张量 (B x H x W x C)                                              |
| `enable_vae_tiling`          | 布尔值              | True        | 必需     | 启用分块以减少显存占用 (可能引入轻微接缝)                                      |
| `temporal_tiling_sample_size`| 整数                | 64          | 必需     | 时间分块大小 (为保证平滑操作必须为64)                                        |
| `spatial_tile_sample_min_size`| 整数                | 256         | 必需     | 最小空间分块大小 (像素，较小值节省显存)                                        |
| `auto_tile_size`             | 布尔值              | True        | 必需     | 根据默认值自动配置分块大小                                                     |
| `noise_aug_strength`         | 浮点数              | 0.0         | 可选     | 向输入图像添加噪声 (增强运动，范围：0.0-10.0)                                  |
| `latent_strength`            | 浮点数              | 1.0         | 可选     | 潜变量输出的缩放因子 (较低值允许更多运动)                                      |
| `latent_dist`                | 下拉选项<sup>1</sup>  | "sample"    | 可选     | 潜变量采样模式 (`sample`/`mode`)                                           |

**输出：** `LATENT`

**使用场景：**
- **图像到视频**工作流 (e2v)
- 为**基于关键帧的生成**预处理参考图像
- 添加噪声增强以引导运动

---

### HyVideoEnhanceAVideo (HyVideo增强视频)

| **参数名称**                | **类型**                        | **默认值**                                     | **属性** | **描述**                                                                        |
| -------------- | -------- | ----------- | ---------- | ------------------------------------------------------ |
| `weight`         | 浮点数   | 2.0         | 必需       | FETA权重，控制增强强度。                                   |
| `single_blocks`  | 布尔值   | True        | 必需       | 是否为单模块启用Enhance-A-Video。                         |
| `double_blocks`  | 布尔值   | True        | 必需       | 是否为双模块启用Enhance-A-Video。                         |
| `start_percent`  | 浮点数   | 0.0         | 必需       | 应用增强的去噪步骤起始百分比。                                   |
| `end_percent`    | 浮点数   | 1.0         | 必需       | 应用增强的去噪步骤结束百分比。                                   |

**输出：** `FETAARGS`

**使用场景：**
* 作为 `HyVideoSampler` 节点的输入以增强细节。
* 对长序列进行锐化和去噪效果显著。

---

### HyVideoLoraSelect (HyVideo LoRA选择)

| **参数名称**                | **类型**                        | **默认值**                                     | **属性** | **描述**                                                                        |
| ------------- | -------------- | ----------- | ---------- | ------------------------------------------------------------------ |
| `lora`          | 文件名列表       | —           | 必需       | `models/loras` 文件夹中LoRA权重文件 (`.safetensors`) 的路径       |
| `strength`      | 浮点数         | `1.0`       | 必需       | LoRA注入强度 (设为0.0以取消合并)                                    |
| `prev_lora`     | HYVIDLORA      | `None`      | 可选       | 链接多个LoRA                                                         |
| `blocks`        | SELECTEDBLOCKS | `None`      | 可选       | 通过 `HyVideoLoraBlockEdit` 进行选择性模块注入                        |

**输出：** `HYVIDLORA`

**使用场景：**
* 向UNet注入风格/个性/角色行为
* 结合多个具有自定义强度的LoRA

---

### HyVideoI2VEncode (HyVideo 图像到视频编码)

| **参数名称**                | **类型**                        | **默认值**                                     | **属性** | **描述**                                                                        |
|--------------------------------|---------------------|-------------|----------|---------------------------------------------------------------------------------|
| `text_encoders`              | HYVIDTEXTENCODER   | —           | 必需     | 来自 `DownloadAndLoadHyVideoTextEncoder` 的文本编码器                       |
| `prompt`                      | 字符串             | ""          | 必需     | 描述视频的文本提示                                                           |
| `force_offload`              | 布尔值              | True        | 可选     | 编码后卸载文本编码器以节省显存                                                 |
| `prompt_template`            | 下拉选项<sup>2</sup>  | "video"     | 可选     | 用于LLM文本编码的预定义模板                                                  |
| `custom_prompt_template`     | PROMPT_TEMPLATE    | —           | 可选     | 自定义模板 (当 `prompt_template` 为 "custom" 时使用)                       |
| `image`                       | IMAGE              | None        | 可选     | 用于图像条件生成的参考图像                                                     |
| `hyvid_cfg`                  | HYVID_CFG          | —           | 可选     | 来自 `HyVideoCFG` 节点的CFG设置                                            |
| `image_embed_interleave`     | 整数                | 2           | 可选     | 文本token中图像嵌入的交错频率                                                |
| `model_to_offload`           | HYVIDEOMODEL       | None        | 可选     | 编码期间卸载视频模型以节省显存                                                 |

**输出：** `HYVIDEMBEDS`

**使用场景：**
- **图像提示视频生成** (IP2V)
- 结合**文本和图像嵌入**进行混合条件控制
- 使用自定义提示模板的高级工作流

---

## HyVideoEncodeKeyframes (HyVideo编码关键帧)

| **参数名称**                | **类型**                        | **默认值**                                     | **属性** | **描述**                                                                        |
| ------------------------------ | ---------------------- | ----------- | ---------- | ------------------------------------------------------- |
| `vae`                          | `VAE`                  | —           | 必需       | 用于编码图像的VAE模型                                       |
| `start_image`                  | `IMAGE`                | —           | 必需       | 第一个关键帧                                                |
| `end_image`                    | `IMAGE`                | —           | 必需       | 最后一个关键帧                                                |
| `num_frames`                   | `整数`                 | `49`        | 必需       | 起始和结束帧之间的总帧数                                      |
| `enable_vae_tiling`            | `布尔值`               | `True`      | 必需       | 是否使用分块VAE编码 (内存优化)                                 |
| `temporal_tiling_sample_size`  | `整数`                 | `64`        | 必需       | 每个时间块的样本大小                                          |
| `spatial_tile_sample_min_size` | `整数`                 | `256`       | 必需       | 最小图像分块大小                                            |
| `auto_tile_size`               | `布尔值`               | `True`      | 必需       | 自动选择分块参数                                            |
| `noise_aug_strength`           | `浮点数`               | `0.0`       | 可选       | 添加噪声以增加变化 (支持LeapFusion)                             |
| `latent_strength`              | `浮点数`               | `1.0`       | 可选       | 缩放潜变量转换的强度                                        |
| `latent_dist`                  | `"sample"` 或 `"mode"` | `sample`    | 可选       | 是采样潜变量分布还是使用众数                                    |

**输出**：`LATENT` – 关键帧之间的插值潜变量张量

**使用场景**：
* 关键帧到视频插值
* 角色姿势到动画工作流
* 使用最少图像输入的长帧过渡

---

## HyVideoCFG (HyVideo CFG)

| **参数名称**                | **类型**                        | **默认值**                                     | **属性** | **描述**                                                                        |
| ------------------- | --------- | ----------- | ---------- | ----------------------------------------------------------------- |
| `cfg`               | `浮点数`  | `6.0`       | 必需       | 分类器自由引导的基础强度                                             |
| `curve`             | `字符串`  | `linear`    | 可选       | 插值函数：线性、缓入/缓出、sigmoid等                                 |
| `start_step`        | `整数`    | `0`         | 可选       | 开始应用CFG的索引                                                   |
| `end_step`          | `整数`    | `-1`        | 可选       | 停止应用CFG的索引 (-1 = 结束)                                       |
| `use_time_fraction` | `布尔值`  | `False`     | 可选       | 将起始/结束解释为总步数的比例 (例如，0.2 = 20%)                          |

**输出**：`CFGARGS` – 分类器自由引导调度

**使用场景**：
* 随时间动态调整提示强度
* 在早期或晚期抑制提示
* 创建更细微或分层的语义影响

---

## HyVideoTextImageEncode (HyVideo图文编码)

| **参数名称**                | **类型**                        | **默认值**                                     | **属性** | **描述**                                                                        |
| ----------------------- | --------------------- | ----------- | ---------- | --------------------------------------------------- |
| `text`                  | `字符串`              | —           | 必需       | 提示文本                                              |
| `text_encoder`          | `HYVIDTEXTENCODER`    | —           | 必需       | 用于处理文本的已加载编码器                                   |
| `image1`                | `IMAGE`               | —           | 必需       | 第一个输入图像                                          |
| `image2`                | `IMAGE`               | —           | 必需       | 第二个输入图像                                          |
| `vae`                   | `VAE`                 | —           | 必需       | 用于编码图像的VAE模型                                   |
| `resolution`            | `整数`                | `512`       | 可选       | 调整图像大小以进行编码                                    |
| `is_negative_prompt`    | `布尔值`              | `False`     | 可选       | 此嵌入是否用作负向提示                                    |
| `custom_prompt_context` | `CustomPromptContext` | —           | 可选       | 用于结构化LLM提示的可选文本格式化                           |

**输出**：`HYVIDEMBEDS` – 融合的图像-文本潜变量嵌入

**使用场景**：
* IP2V: **图像 + 提示 → 视频** 工作流
* 参考引导的动画
* 结合两个图像的外观/风格与文本行为/控制

---

## HyVideoTextImageEncode (HyVideo图文编码)

| **参数名称**                | **类型**                        | **默认值**                                     | **属性** | **描述**                                                                        |
| ----------------------- | --------------------- | ----------- | ---------- | --------------------------------------------------- |
| `text`                  | `字符串`              | —           | 必需       | 提示文本                                              |
| `text_encoder`          | `HYVIDTEXTENCODER`    | —           | 必需       | 用于处理文本的已加载编码器                                   |
| `image1`                | `IMAGE`               | —           | 必需       | 第一个输入图像                                          |
| `image2`                | `IMAGE`               | —           | 必需       | 第二个输入图像                                          |
| `vae`                   | `VAE`                 | —           | 必需       | 用于编码图像的VAE模型                                   |
| `resolution`            | `整数`                | `512`       | 可选       | 调整图像大小以进行编码                                    |
| `is_negative_prompt`    | `布尔值`              | `False`     | 可选       | 此嵌入是否用作负向提示                                    |
| `custom_prompt_context` | `CustomPromptContext` | —           | 可选       | 用于结构化LLM提示的可选文本格式化                           |

**输出**：`HYVIDEMBEDS` – 融合的图像-文本潜变量嵌入

**使用场景**：
* IP2V: **图像 + 提示 → 视频** 工作流
* 参考引导的动画
* 结合两个图像的外观/风格与文本行为/控制

---

### HyVideoInverseSampler (HyVideo逆向采样器)

| **参数名称**                | **类型**                        | **默认值**                                     | **属性** | **描述**                                                                        |
|-----------------------------|---------------------|-------------|----------|---------------------------------------------------------------------------------|
| `model`                    | HYVIDEOMODEL      | —           | 必需     | 预加载的Hunyuan模型                                                        |
| `hyvid_embeds`             | HYVIDEMBEDS       | —           | 必需     | 空文本嵌入 (与 `HyVideoEmptyTextEmbeds` 一起使用)                          |
| `samples`                  | LATENT            | —           | 必需     | 目标潜变量 (要反演的视频)                                                    |
| `steps`                    | 整数                | 30          | 必需     | 逆向采样步骤                                                               |
| `gamma`                    | 浮点数              | 0.5         | 必需     | 噪声插值强度 (0=完全反演, 1=完全正向)                                       |
| `gamma_trend`              | 下拉选项            | "constant"  | 必需     | 强度变化趋势                                                               |

**输出：** `LATENT` (反演后的潜变量)

**使用场景：**
- 用于视频编辑的潜变量空间反演
- 使用 `HyVideoReSampler` 进行帧一致性修复

---

### HyVideoReSampler (HyVideo重采样器)

| **参数名称**                | **类型**                        | **默认值**                                     | **属性** | **描述**                                                                        |
|-----------------------------|---------------------|-------------|----------|---------------------------------------------------------------------------------|
| `inversed_latents`         | LATENT            | —           | 必需     | 反演后的潜变量 (来自 `HyVideoInverseSampler`)                               |
| `eta_base`                 | 浮点数              | 0.5         | 必需     | 基础重采样强度                                                             |
| `eta_trend`                | 下拉选项            | "constant"  | 必需     | 时间强度分布曲线                                                           |

**输出：** `LATENT` (优化后的潜变量)

**使用场景：**
- 修复生成视频中的闪烁问题
- 增强长视频的时间一致性

---

### HyVideoPromptMixSampler (HyVideo提示混合采样器)

| **参数名称**                | **类型**                        | **默认值**                                     | **属性** | **描述**                                                                        |
|-----------------------------|---------------------|-------------|----------|---------------------------------------------------------------------------------|
| `hyvid_embeds_2`          | HYVIDEMBEDS       | —           | 必需     | 第二个提示嵌入向量                                                           |
| `alpha`                    | 浮点数              | 0.5         | 必需     | 提示混合锐度 (0-1, 越高过渡越突然)                                          |
| `interpolation_curve`      | 浮点数数组          | —           | 可选     | 每帧混合权重曲线                                                             |

**输出：** `LATENT` (混合后的潜变量)

**使用场景：**
- 提示之间的动态过渡 (例如场景变形)
- 多风格融合生成

---

### HyVideoLoraBlockEdit (HyVideo LoRA模块编辑)

| **参数名称**                | **类型**                        | **默认值**                                     | **属性** | **描述**                                                                        |
| ------------------- | -------- | ----------- | ---------- | ---------------------------------------------- |
| `double_blocks.0–19` | 布尔值   | True        | 必需       | 切换20个双模块中每个模块的注入状态。                      |
| `single_blocks.0–39` | 布尔值   | True        | 必需       | 切换40个单模块中每个模块的注入状态。                      |

**输出：** `SELECTEDBLOCKS`

---

### HyVideoLoraBlockEdit (HyVideo LoRA模块编辑)

| **参数名称**                | **类型**                        | **默认值**                                     | **属性** | **描述**                                                                        |
| ------------------- | -------- | ----------- | ---------- | ---------------------------------------------- |
| `double_blocks.0–19` | 布尔值   | True        | 必需       | 切换20个双模块中每个模块的注入状态。                      |
| `single_blocks.0–39` | 布尔值   | True        | 必需       | 切换40个单模块中每个模块的注入状态。                      |

**输出**：`SELECTEDBLOCKS`

**使用场景**：
* 与 `HyVideoLoraSelect` 配合使用，将LoRA应用于特定模块。
* 实现风格/角色注入的细粒度控制。
* 与 `HyVideoLoraSelect` 配合使用，将LoRA应用于特定模块。
* 实现风格/角色注入的细粒度控制。

---

### HyVideoEnableAVideo (HyVideoEnhanceAVideo) (HyVideo启用视频增强)

| **参数名称**                | **类型**                        | **默认值**                                     | **属性** | **描述**                                                                        |
|-----------------------------|---------------------|-------------|----------|---------------------------------------------------------------------------------|
| `weight`                   | 浮点数              | 2.0         | 必需     | 增强强度 (>1.0 增强细节, <1.0 平滑输出)                                  |
| `start_percent`            | 浮点数              | 0.0         | 必需     | 增强的起始步骤百分比                                                         |
| `end_percent`              | 浮点数              | 1.0         | 必需     | 增强的结束步骤百分比                                                         |

**输出**：`FETAARGS`

**使用场景**：
- 修复低质量生成结果
- 增强视频纹理细节

---

### HyVideoSTG (HyVideo时空引导)

| **参数名称**                | **类型**                        | **默认值**                                     | **属性** | **描述**                                                                        |
| ------------------- | -------- | ----------- | ---------- | ---------------------------------------------------------------- |
| `stg_mode`           | 下拉选项   | STG-A       | 必需       | 时空引导模式：`STG-A` 或 `STG-R`。                               |
| `stg_block_idx`     | 整数       | 0           | 必需       | 应用引导的模块索引 (-1 到 39)。                                     |
| `stg_scale`          | 浮点数   | 1.0         | 必需       | STG效果强度 (推荐 ≤ 2.0)。                                      |
| `stg_start_percent` | 浮点数   | 0.0         | 必需       | 何时开始应用引导 (占去噪步骤的百分比)。                                |
| `stg_end_percent`   | 浮点数   | 1.0         | 必需       | 何时结束应用引导 (占去噪步骤的百分比)。                                |

**输出**：`STGARGS`

**使用场景**：
* 应用于 `HyVideoSampler` 以保持时间一致性。
* 适用于关键帧和长运动场景。

---

### HunyuanVideoFresca (混元视频FreSca)

| **参数名称**                | **类型**                        | **默认值**                                     | **属性** | **描述**                                                                        |
| -------------------- | -------- | ----------- | ---------- | ------------------------------------------------------------- |
| `fresca_scale_low`   | 浮点数   | `1.0`       | 必需       | 低频段的频率调制缩放                                             |
| `fresca_scale_high`  | 浮点数   | `1.25`      | 必需       | 高频段的频率调制缩放                                             |
| `fresca_freq_cutoff` | 整数     | `20`        | 必需       | 用于区分低/高调制的频率截止阈值                                    |

**输出**：`FRESCA_ARGS`

**使用场景**：
* 应用基于频率的风格迁移
* 使用频谱调制动画化纹理或特征

---

### HyVideoLatentPreview (HyVideo潜变量预览)

| **参数名称**                | **类型**                        | **默认值**                                     | **属性** | **描述**                                                                        |
|-----------------------------|---------------------|-------------|----------|---------------------------------------------------------------------------------|
| `min_val`                  | 浮点数              | -0.15       | 必需     | 潜变量可视化的最小值映射                                                       |
| `max_val`                  | 浮点数              | 0.15        | 必需     | 潜变量可视化的最大值映射                                                       |
| `rgb_bias`                 | 浮点数数组[3]       | [0,0,0]     | 必需     | RGB通道偏置调整                                                            |

**输出：** `IMAGE` (预览), `字符串` (颜色映射公式)

**使用场景：**
- 潜变量空间调试和可视化
- 无需完整解码的快速内容检查

---

### HyVideoLatentPreview (HyVideo潜变量预览)

| **参数名称**                | **类型**                        | **默认值**                                     | **属性** | **描述**                                                                        |
|-----------------------------|---------------------|-------------|----------|---------------------------------------------------------------------------------|
| `min_val`                  | 浮点数              | -0.15       | 必需     | 潜变量可视化的最小值映射                                                       |
| `max_val`                  | 浮点数              | 0.15        | 必需     | 潜变量可视化的最大值映射                                                       |
| `rgb_bias`                 | 浮点数数组[3]       | [0,0,0]     | 必需     | RGB通道偏置调整                                                            |

**输出**：`IMAGE` (预览), `字符串` (颜色映射公式)

**使用场景**：
- 潜变量空间调试和可视化
- 无需完整解码的快速内容检查

---

### HyVideoCustomPromptTemplate (HyVideo自定义提示模板)

| **参数名称**                | **类型**                        | **默认值**                                     | **属性** | **描述**                                                                        |
|-----------------------------|---------------------|-------------|----------|---------------------------------------------------------------------------------|
| `custom_prompt_template`  | 字符串              | —           | 必需     | 自定义模板 (必须包含 `{}` 占位符)                                           |
| `crop_start`               | 整数                | 0           | 必需     | 系统提示截断位置                                                             |

**输出**：`PROMPT_TEMPLATE`

**使用场景**：
- 针对非标准语言模型的提示工程
- 多任务工作流的统一模板管理

---

### HyVideoSTG (HyVideo时空引导)

| **参数名称**                | **类型**                        | **默认值**                                     | **属性** | **描述**                                                                        |
| ------------------- | -------- | ----------- | ---------- | ---------------------------------------------------------------- |
| `stg_mode`           | 下拉选项   | STG-A       | 必需       | 时空引导模式：`STG-A` 或 `STG-R`。                               |
| `stg_block_idx`     | 整数       | 0           | 必需       | 应用引导的模块索引 (-1 到 39)。                                     |
| `stg_scale`          | 浮点数   | 1.0         | 必需       | STG效果强度 (推荐 ≤ 2.0)。                                      |
| `stg_start_percent` | 浮点数   | 0.0         | 必需       | 何时开始应用引导 (占去噪步骤的百分比)。                                |
| `stg_end_percent`   | 浮点数   | 1.0         | 必需       | 何时结束应用引导 (占去噪步骤的百分比)。                                |

**输出**：`STGARGS`

**使用场景**：
* 应用于 `HyVideoSampler` 以保持时间一致性。
* 适用于关键帧和长运动场景。

---

### HunyuanVideoFresca (混元视频FreSca)

| **参数名称**                | **类型**                        | **默认值**                                     | **属性** | **描述**                                                                        |
| -------------------- | -------- | ----------- | ---------- | ------------------------------------------------------------- |
| `fresca_scale_low`   | 浮点数   | `1.0`       | 必需       | 低频段的频率调制缩放                                             |
| `fresca_scale_high`  | 浮点数   | `1.25`      | 必需       | 高频段的频率调制缩放                                             |
| `fresca_freq_cutoff` | 整数     | `20`        | 必需       | 用于区分低/高调制的频率截止阈值                                    |

**输出**：`FRESCA_ARGS`

**使用场景**：
* 应用基于频率的风格迁移
* 使用频谱调制动画化纹理或特征

---

### HunyuanVideoSLG (混元视频SLG)

| **参数名称**                | **类型**                        | **默认值**                                     | **属性** | **描述**                                                                        |
|-----------------------------|---------------------|-------------|----------|---------------------------------------------------------------------------------|
| `single_blocks`            | 字符串              | "20"        | 必需     | 要跳过无条件计算的单模块索引 (逗号分隔)                                      |
| `start_percent`            | 浮点数              | 0.4         | 必需     | SLG激活起始步骤百分比                                                      |
| `end_percent`              | 浮点数              | 0.8         | 必需     | SLG激活结束步骤百分比                                                      |

**输出**：`SLGARGS`

**使用场景**：
- 减少高动态场景中的运动模糊
- 加速生成 (牺牲部分多样性)

---

### HyVideoLoopArgs (HyVideo循环参数)

| **参数名称**                | **类型**                        | **默认值**                                     | **属性** | **描述**                                                                        |
| -------------- | -------- | ----------- | ---------- | --------------------------------------------- |
| `shift_skip`    | 整数     | `6`         | 必需       | 每个循环要跳过的潜变量移位步数                                  |
| `start_percent` | 浮点数   | `0.0`       | 必需       | 循环开始的生成百分比                                        |
| `end_percent`   | 浮点数   | `1.0`       | 必需       | 循环结束的生成百分比                                        |

**输出**：`LOOPARGS`

**使用场景**：
* 实现无缝视频循环效果
* 支持受莫比乌斯方法启发的潜变量移位插值

---

### HyVideoContextOptions (HyVideo上下文选项)

| **参数名称**                | **类型**                        | **默认值**                                     | **属性** | **描述**                                                                        |
| ----------------- | -------- | ------------------ | ---------- | -------------------------------------------------------------- |
| `context_schedule` | 下拉选项   | `uniform_standard` | 必需       | 上下文窗口调度策略                                                 |
| `context_frames`   | 整数     | `65`               | 必需       | 每个上下文窗口的像素帧数 (4个潜变量 = 1像素帧)                          |
| `context_stride`   | 整数     | `4`                | 必需       | 每个上下文窗口之间的步长                                           |
| `context_overlap`  | 整数     | `4`                | 必需       | 上下文窗口之间的重叠                                               |
| `freenoise`        | 布尔值   | `True`             | 必需       | 是否在上下文块之间打乱噪声                                           |

**输出**：`HYVIDCONTEXT`

**使用场景**：
* 将长视频序列分割成具有上下文感知的分块
* 优化内存使用，同时保持片段间的一致性

----

### 🔄 常见工作流组合

| 工作流名称             | 节点组合                                                            | 目的                                  |
| ------------------------- | --------------------------------------------------------------------------- | ---------------------------------------- |
| 首尾帧视频生成(hyvideo_dashtoon_keyframe_example_01)  | HyVideoTorchCompileSettings → HyVideoVAELoader → Reroute → HyVideoEncodeKeyframes & HyVideoDecode → HyVideoSampler → HyVideoDecode → VHS_VideoCombine                   | 关键帧图像引导的视频生成                 |
| 视频到视频生成(hunhyuan_rf_inversion_testing_01 )        | VHS_LoadVideo → ImageResizeKJ → Set_InputVideo → GetImageSizeAndCount → HyVideoEncode → HyVideoInverseSampler → HyVideoReSampler → HyVideoDecode → ImageConcatMulti → VHS_VideoCombine                          | 反向推理 + 重采样测试           |
| 图像到视频生成(hyvideo_ip2v_experimental_dango )  | LoadImage → HyVideoGetClosestBucketSize → ImageScale → GetImageSizeAndCount → HyVideoEncode → HyVideoI2VEncode → HyVideoSampler → HyVideoDecode → GetImageSizeAndCount → ImageConcatMulti → VHS_VideoCombine                         | 图像驱动的视频生成    |
| 文本到视频生成 (hyvideo_t2v_example_01)     | DownloadAndLoadHyVideoTextEncoder → HyVideoTextEncode → HyVideoSampler → HyVideoDecode → VHS_VideoCombine | 文本驱动的视频生成 |